<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productos de Belleza Coreana</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Estilos para el modal de producto */
        .product-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .product-modal {
            background: white;
            border-radius: 8px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalFadeIn 0.3s ease;
            position: relative;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            z-index: 10;
        }

        .modal-close:hover {
            background-color: #f5f5f5;
        }

        .modal-content {
            padding: 30px;
        }

        .modal-product-info {
            display: flex;
            gap: 40px;
            flex-wrap: wrap;
        }

        .modal-product-image {
            flex: 0 0 300px;
        }

        .modal-product-image .image-container {
            height: 300px;
            border-radius: 8px;
            overflow: hidden;
            background-color: #f5f5f5;
            position: relative;
            cursor: pointer;
        }

        .modal-product-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background-color: white;
        }

        .modal-product-details {
            flex: 1;
            min-width: 300px;
        }

        .modal-product-title {
            font-size: 24px;
            margin-bottom: 15px;
            color: #333;
        }

        .modal-product-price {
            font-size: 28px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .modal-description {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 4px;
            margin-top: 20px;
        }

        .modal-description h3 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #333;
        }

        .modal-description p {
            color: #666;
            line-height: 1.6;
        }

        /* Bot√≥n para abrir galer√≠a en modal */
        .btn-view-gallery-modal {
            background-color: transparent;
            color: #333;
            border: 1px solid #ddd;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            margin-right: 10px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-view-gallery-modal:hover {
            background-color: #f5f5f5;
            border-color: #ccc;
        }

        /* Indicador de carga */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 18px;
            grid-column: 1 / -1;
        }

        .loading i {
            font-size: 24px;
            margin-bottom: 10px;
            display: block;
        }

        /* Contenedor principal de productos */
        .productos-section {
            padding: 40px 0;
        }
    </style>
</head>
<body>
    <!-- Header con navegaci√≥n -->
    <header>
        <div class="container header-container">
            <div class="logo">Belleza<span>Coreana</span></div>
            
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Buscar productos...">
                <button onclick="buscarProductos()"><i class="fas fa-search"></i></button>
            </div>
            
            <div class="header-icons">
                <a href="index.html" title="Inicio"><i class="fas fa-home"></i></a>
                <a href="carrito.html" title="Carrito"><i class="fas fa-shopping-cart"></i><span class="cart-badge" id="cartBadge">0</span></a>
            </div>
        </div>

        <!-- NAVBAR COMO EN LA IMAGEN - ACTUALIZADO -->
        <nav class="main-nav">
            <div class="nav-container">
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#" class="nav-link active">CUIDADO DE LA PIEL <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-menu">
                            <div class="dropdown-column">
                                <ul>
                                    <li><a href="#">Cremas Hidratantes</a></li>
                                    <li><a href="#">Limpiadores faciales</a></li>
                                    <li><a href="#">S√©rums faciales</a></li>
                                    <li><a href="#">T√≥nicos faciales</a></li>
                                    <li><a href="#">Protectores Solares</a></li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    
                    <li class="nav-item">
                        <a href="#" class="nav-link">M√ÅS BELLEZA <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-menu">
                            <div class="dropdown-column">
                                <ul>
                                    <li><a href="#">Cuidado de manos y pies</a></li>
                                    <li><a href="#">Perfumes y Fragancias</a></li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    
                    <li class="nav-item">
                        <a href="#" class="nav-link">MARCAS <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-menu">
                            <div class="dropdown-column">
                                <ul>
                                    <li><a href="#">Anua</a></li>
                                    <li><a href="#">Beauty of Joseon</a></li>
                                    <li><a href="#">COSRX</a></li>
                                    <li><a href="#">I'm from</a></li>
                                    <li><a href="#">iUNIK</a></li>
                                    <li><a href="#">romand</a></li>
                                    <li><a href="#">LANEIGE</a></li>
                                    <li><a href="#">Robto Mentholatum</a></li>
                                    <li><a href="#">Shu Uemura</a></li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    
                    <li class="nav-item">
                        <a href="#" class="nav-link">CUIDADO DEL CABELLO <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-menu">
                            <div class="dropdown-column">
                                <ul>
                                    <li><a href="#">Champ√∫s</a></li>
                                    <li><a href="#">Tratamientos para Cabello</a></li>
                                </ul>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <!-- Contenido principal -->
    <main class="productos-section">
        <div class="container">
            <!-- Grid de productos -->
            <div class="products-grid" id="productsContainer">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    Cargando productos...
                </div>
            </div>
        </div>
    </main>

    <!-- Modal para detalles del producto -->
    <div id="productModal" class="product-modal-overlay"></div>

    <!-- Modal para galer√≠a de im√°genes -->
    <div id="galleryModal" class="gallery-modal-overlay"></div>

    <script>
        // =================== VARIABLES GLOBALES ===================
        let todosProductos = [];           // Todos los productos del JSON
        let productosFiltrados = [];       // Productos despu√©s de filtros
        
        // =================== FUNCIONES PRINCIPALES ===================
        
        // Funci√≥n para cargar productos desde el JSON
        async function cargarProductos() {
            try {
                console.log('üîÑ Cargando productos desde products.json...');
                
                const response = await fetch('products.json?v=' + Date.now());
                if (!response.ok) throw new Error('Error al cargar JSON');
                
                const data = await response.json();
                todosProductos = data.productos;
                console.log(`‚úÖ ${todosProductos.length} productos cargados exitosamente`);
                
                // Inicializar productos filtrados
                productosFiltrados = [...todosProductos];
                
                // Mostrar productos
                mostrarProductos();
                actualizarContadorCarrito();
                
            } catch (error) {
                console.error('‚ùå Error al cargar productos:', error);
                mostrarError('No se pudieron cargar los productos. Por favor, intenta m√°s tarde.');
            }
        }
        
        // Funci√≥n para mostrar productos en el grid
        function mostrarProductos() {
            const container = document.getElementById('productsContainer');
            if (!container) return;
            
            if (productosFiltrados.length === 0) {
                container.innerHTML = `
                    <div class="no-products" style="text-align: center; padding: 40px; grid-column: 1/-1;">
                        <i class="fas fa-search" style="font-size: 48px; color: #ddd; margin-bottom: 20px;"></i>
                        <h3 style="color: #666; margin-bottom: 10px;">No se encontraron productos</h3>
                        <p>Intenta con otros t√©rminos de b√∫squeda</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            productosFiltrados.forEach(producto => {
                // Obtener la primera imagen del array de im√°genes (si existe)
                const imagenUrl = (producto.imagenes && producto.imagenes.length > 0) ? producto.imagenes[0] : null;
                
                // Determinar color de fondo seg√∫n categor√≠a (para placeholder)
                const colorFondo = getColorPorCategoria(producto.categoria);
                
                // Generar im√°genes para la galer√≠a
                const galeriaImagenes = generarImagenesGaleria(producto);
                
                html += `
                    <div class="product-card" data-id="${producto.id}" onclick="abrirModalProducto(${producto.id})">
                        <div class="product-card-image">
                            ${imagenUrl ? 
                                `<img src="${imagenUrl}" 
                                      alt="${producto.nombre}"
                                      loading="lazy"
                                      onerror="manejarErrorImagen(this, '${producto.marca}', '${colorFondo}')">` 
                                : 
                                `<div class="image-placeholder" style="background-color: ${colorFondo}">
                                    ${producto.marca}
                                </div>`
                            }
                        </div>
                        
                        <div class="product-card-info">
                            <h3 class="product-card-title">${producto.nombre}</h3>
                            
                            <div class="product-card-price">
                                <span class="product-current-price">US$ ${producto.precio.toFixed(2)}</span>
                            </div>
                            
                            <div class="product-card-actions">
                                <button class="btn-add" onclick="event.stopPropagation(); agregarAlCarrito(${producto.id}, this)">
                                    AGREGAR A LA CESTA
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Generar im√°genes para la galer√≠a desde el array de im√°genes
        function generarImagenesGaleria(producto) {
            // Si el producto tiene array de im√°genes, usarlas todas
            if (producto.imagenes && Array.isArray(producto.imagenes) && producto.imagenes.length > 0) {
                return producto.imagenes; // Devuelve todas las im√°genes del array
            }
            
            // Si no hay im√°genes, usar placeholders
            const colorHex = getColorHex(producto.categoria);
            return [
                `https://via.placeholder.com/400x400/${colorHex}/FFFFFF?text=${encodeURIComponent(producto.marca)}`,
                `https://via.placeholder.com/400x400/${colorHex}/FFFFFF?text=${encodeURIComponent(producto.marca)}+2`,
                `https://via.placeholder.com/400x400/${colorHex}/FFFFFF?text=${encodeURIComponent(producto.marca)}+3`,
                `https://via.placeholder.com/400x400/${colorHex}/FFFFFF?text=${encodeURIComponent(producto.marca)}+4`
            ];
        }
        
        // Obtener color hexadecimal para placeholder
        function getColorHex(categoria) {
            const colores = {
                'S√©rums Faciales': 'e6f0f7',
                'Cremas Hidratantes': 'f7e6e6',
                'Cremas Faciales': 'f7f0e6',
                'Limpieza Facial': 'e6f7e9',
                'Esencias': 'f7e6f7',
                'Ampollas': 'e6e7f7',
                'default': 'f5f5f5'
            };
            
            if (!categoria) return colores.default;
            
            for (const [key, color] of Object.entries(colores)) {
                if (categoria.includes(key)) return color;
            }
            return colores.default;
        }
        
        // Funci√≥n para manejar errores de carga de im√°genes
        function manejarErrorImagen(imgElement, marca, colorFondo) {
            imgElement.onerror = null; // Prevenir bucles infinitos
            
            // Ocultar la imagen
            imgElement.style.display = 'none';
            
            // Crear placeholder si no existe
            let placeholder = imgElement.nextElementSibling;
            if (!placeholder || !placeholder.classList.contains('image-placeholder')) {
                placeholder = document.createElement('div');
                placeholder.className = 'image-placeholder';
                placeholder.style.backgroundColor = colorFondo || '#f5f5f5';
                placeholder.textContent = marca;
                imgElement.parentNode.appendChild(placeholder);
            }
            
            placeholder.style.display = 'flex';
        }
        
        // Funci√≥n para obtener color seg√∫n categor√≠a
        function getColorPorCategoria(categoria) {
            const colores = {
                'S√©rums Faciales': '#e6f0f7',
                'Cremas Hidratantes': '#f7e6e6',
                'Cremas Faciales': '#f7f0e6',
                'Limpieza Facial': '#e6f7e9',
                'Esencias': '#f7e6f7',
                'Ampollas': '#e6e7f7',
                'Mascarillas': '#f0e6f7',
                'T√≥nicos': '#e6f4f7',
                'Protector solar': '#fff7e6',
                'Labios': '#f7e6f0',
                'Bases de Maquillaje': '#e6f0f7',
                'Cuidado de Cabello': '#f0f7e6',
                'default': '#f5f5f5'
            };
            
            if (!categoria) return colores.default;
            
            for (const [key, color] of Object.entries(colores)) {
                if (categoria.includes(key)) return color;
            }
            return colores.default;
        }
        
        // Funci√≥n para mostrar error
        function mostrarError(mensaje) {
            const container = document.getElementById('productsContainer');
            if (container) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; grid-column: 1/-1;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #d97777; margin-bottom: 20px;"></i>
                        <h3 style="color: #666; margin-bottom: 10px;">Error</h3>
                        <p>${mensaje}</p>
                        <button onclick="cargarProductos()" style="margin-top: 20px; padding: 10px 20px; background: #333; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            Reintentar
                        </button>
                    </div>
                `;
            }
        }
        
        // Funci√≥n para buscar productos
        function buscarProductos() {
            const searchInput = document.getElementById('searchInput');
            const termino = searchInput.value.toLowerCase().trim();
            
            if (termino === '') {
                productosFiltrados = [...todosProductos];
            } else {
                productosFiltrados = todosProductos.filter(producto => {
                    return producto.nombre.toLowerCase().includes(termino) ||
                           producto.marca.toLowerCase().includes(termino) ||
                           (producto.categoria && producto.categoria.toLowerCase().includes(termino)) ||
                           (producto.descripcion && producto.descripcion.toLowerCase().includes(termino));
                });
            }
            
            mostrarProductos();
        }
        
        // =================== FUNCIONES DE GALER√çA ===================
        
        // Funci√≥n para abrir galer√≠a de im√°genes de un producto
        function abrirGaleriaProducto(productId) {
            try {
                // Buscar el producto
                const producto = todosProductos.find(p => p.id === productId);
                
                if (!producto) {
                    console.error(`Producto con ID ${productId} no encontrado`);
                    alert('Producto no encontrado');
                    return;
                }
                
                // Generar im√°genes para la galer√≠a
                const imagenesGaleria = generarImagenesGaleria(producto);
                
                // Crear contenido de la galer√≠a
                const galeriaHTML = `
                    <div class="gallery-modal">
                        <button class="gallery-close" onclick="cerrarGaleria()">√ó</button>
                        <div class="gallery-container">
                            <div class="gallery-main-image" id="galleryMainImage">
                                <img src="${imagenesGaleria[0]}" alt="${producto.nombre}" id="mainGalleryImage">
                                <div class="gallery-counter" id="galleryCounter">1 / ${imagenesGaleria.length}</div>
                                <button class="gallery-nav gallery-prev" onclick="cambiarImagenGaleria(-1)">‚Äπ</button>
                                <button class="gallery-nav gallery-next" onclick="cambiarImagenGaleria(1)">‚Ä∫</button>
                            </div>
                            <div class="gallery-thumbnails" id="galleryThumbnails">
                                ${imagenesGaleria.map((img, index) => `
                                    <div class="thumbnail ${index === 0 ? 'active' : ''}" onclick="seleccionarImagenGaleria(${index})">
                                        <img src="${img}" alt="${producto.nombre} - Vista ${index + 1}" loading="lazy">
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
                
                // Insertar galer√≠a en el contenedor
                const galeriaContainer = document.getElementById('galleryModal');
                if (galeriaContainer) {
                    galeriaContainer.innerHTML = galeriaHTML;
                    galeriaContainer.style.display = 'flex';
                    
                    // Almacenar datos de la galer√≠a
                    galeriaContainer.dataset.imagenes = JSON.stringify(imagenesGaleria);
                    galeriaContainer.dataset.indiceActual = '0';
                    galeriaContainer.dataset.productoId = productId;
                    
                    // Prevenir scroll del body
                    document.body.style.overflow = 'hidden';
                    
                    // Cerrar galer√≠a al hacer clic fuera
                    galeriaContainer.addEventListener('click', function(e) {
                        if (e.target === this) {
                            cerrarGaleria();
                        }
                    });
                    
                    // Cerrar con ESC
                    document.addEventListener('keydown', function escHandler(e) {
                        if (e.key === 'Escape') {
                            cerrarGaleria();
                            document.removeEventListener('keydown', escHandler);
                        }
                        // Navegaci√≥n con teclado
                        if (e.key === 'ArrowLeft') cambiarImagenGaleria(-1);
                        if (e.key === 'ArrowRight') cambiarImagenGaleria(1);
                    });
                }
                
            } catch (error) {
                console.error('Error al abrir galer√≠a:', error);
                alert('Error al cargar la galer√≠a de im√°genes');
            }
        }
        
        // Cerrar galer√≠a
        function cerrarGaleria() {
            const galeriaContainer = document.getElementById('galleryModal');
            if (galeriaContainer) {
                galeriaContainer.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }
        
        // Cambiar imagen en la galer√≠a
        function cambiarImagenGaleria(direccion) {
            const galeriaContainer = document.getElementById('galleryModal');
            if (!galeriaContainer) return;
            
            const imagenes = JSON.parse(galeriaContainer.dataset.imagenes || '[]');
            let indiceActual = parseInt(galeriaContainer.dataset.indiceActual || '0');
            
            // Calcular nuevo √≠ndice
            indiceActual += direccion;
            if (indiceActual < 0) indiceActual = imagenes.length - 1;
            if (indiceActual >= imagenes.length) indiceActual = 0;
            
            // Actualizar imagen principal
            const mainImage = document.getElementById('mainGalleryImage');
            if (mainImage) {
                mainImage.style.opacity = '0';
                setTimeout(() => {
                    mainImage.src = imagenes[indiceActual];
                    mainImage.style.opacity = '1';
                }, 200);
            }
            
            // Actualizar contador
            const counter = document.getElementById('galleryCounter');
            if (counter) {
                counter.textContent = `${indiceActual + 1} / ${imagenes.length}`;
            }
            
            // Actualizar miniaturas activas
            const thumbnails = document.querySelectorAll('.thumbnail');
            thumbnails.forEach((thumb, index) => {
                thumb.classList.toggle('active', index === indiceActual);
            });
            
            // Actualizar √≠ndice almacenado
            galeriaContainer.dataset.indiceActual = indiceActual.toString();
        }
        
        // Seleccionar imagen espec√≠fica desde miniatura
        function seleccionarImagenGaleria(indice) {
            const galeriaContainer = document.getElementById('galleryModal');
            if (!galeriaContainer) return;
            
            const imagenes = JSON.parse(galeriaContainer.dataset.imagenes || '[]');
            
            if (indice >= 0 && indice < imagenes.length) {
                // Actualizar imagen principal
                const mainImage = document.getElementById('mainGalleryImage');
                if (mainImage) {
                    mainImage.style.opacity = '0';
                    setTimeout(() => {
                        mainImage.src = imagenes[indice];
                        mainImage.style.opacity = '1';
                    }, 200);
                }
                
                // Actualizar contador
                const counter = document.getElementById('galleryCounter');
                if (counter) {
                    counter.textContent = `${indice + 1} / ${imagenes.length}`;
                }
                
                // Actualizar miniaturas activas
                const thumbnails = document.querySelectorAll('.thumbnail');
                thumbnails.forEach((thumb, index) => {
                    thumb.classList.toggle('active', index === indice);
                });
                
                // Actualizar √≠ndice almacenado
                galeriaContainer.dataset.indiceActual = indice.toString();
            }
        }
        
        // =================== FUNCIONES DE MODAL DE PRODUCTO ===================
        
        // Funci√≥n para abrir modal con producto
        function abrirModalProducto(productId) {
            try {
                // Buscar el producto en TODOS los productos
                const producto = todosProductos.find(p => p.id === productId);
                
                if (!producto) {
                    console.error(`Producto con ID ${productId} no encontrado`);
                    alert('Producto no encontrado');
                    return;
                }
                
                // Obtener la primera imagen del array de im√°genes (si existe)
                const imagenUrl = (producto.imagenes && producto.imagenes.length > 0) ? producto.imagenes[0] : null;
                const colorFondo = getColorPorCategoria(producto.categoria);
                
                // Generar im√°genes para la galer√≠a
                const galeriaImagenes = generarImagenesGaleria(producto);
                
                // Crear contenido del modal
                const modalHTML = `
                    <div class="product-modal">
                        <button class="modal-close" onclick="cerrarModalProducto()">√ó</button>
                        <div class="modal-content">
                            <div class="modal-product-info">
                                <div class="modal-product-image">
                                    <div class="image-container" onclick="abrirGaleriaDesdeModal(${producto.id})">
                                        ${imagenUrl ? 
                                            `<img src="${imagenUrl}" 
                                                  alt="${producto.nombre}"
                                                  onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';">` 
                                            : 
                                            ''
                                        }
                                        <div class="image-placeholder" style="display: ${imagenUrl ? 'none' : 'flex'}; background-color: ${colorFondo}">
                                            ${producto.marca}
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-product-details">
                                    <h2 class="modal-product-title">${producto.nombre}</h2>
                                    <div class="modal-product-price">US$ ${producto.precio.toFixed(2)}</div>
                                    <p><strong>Marca:</strong> ${producto.marca}</p>
                                    ${producto.categoria ? `<p><strong>Categor√≠a:</strong> ${producto.categoria}</p>` : ''}
                                    
                                    <div class="action-buttons" style="margin-top: 20px;">
                                        <button class="btn-view-gallery-modal" onclick="abrirGaleriaDesdeModal(${producto.id})">
                                            <i class="fas fa-images"></i> Ver Galer√≠a (${galeriaImagenes.length} im√°genes)
                                        </button>
                                        <button class="btn-add" onclick="agregarAlCarritoDesdeModal(${producto.id})">
                                            AGREGAR A LA CESTA
                                        </button>
                                    </div>
                                    
                                    <div class="modal-description">
                                        <h3>Descripci√≥n del Producto</h3>
                                        <p>${producto.descripcion || 'Sin descripci√≥n disponible.'}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Insertar modal en el contenedor
                const modalContainer = document.getElementById('productModal');
                if (modalContainer) {
                    modalContainer.innerHTML = modalHTML;
                    modalContainer.style.display = 'flex';
                    
                    // Prevenir scroll del body
                    document.body.style.overflow = 'hidden';
                    
                    // Cerrar modal al hacer clic fuera
                    modalContainer.addEventListener('click', function(e) {
                        if (e.target === this) {
                            cerrarModalProducto();
                        }
                    });
                    
                    // Cerrar con ESC
                    document.addEventListener('keydown', function escHandler(e) {
                        if (e.key === 'Escape') {
                            cerrarModalProducto();
                            document.removeEventListener('keydown', escHandler);
                        }
                    });
                }
                
            } catch (error) {
                console.error('Error al abrir modal:', error);
                alert('Error al cargar los detalles del producto');
            }
        }
        
        // Abrir galer√≠a desde el modal de producto
        function abrirGaleriaDesdeModal(productId) {
            cerrarModalProducto();
            setTimeout(() => abrirGaleriaProducto(productId), 300);
        }
        
        function cerrarModalProducto() {
            const modalContainer = document.getElementById('productModal');
            if (modalContainer) {
                modalContainer.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }
        
        function agregarAlCarritoDesdeModal(productId) {
            agregarAlCarrito(productId);
            cerrarModalProducto();
        }
        
        // =================== FUNCIONES DE CARRITO ===================
        
        // Funci√≥n para agregar al carrito (MODIFICADA: eliminada la notificaci√≥n)
        function agregarAlCarrito(productId, buttonElement = null) {
            console.log(`üõí Agregando producto ${productId} al carrito`);
            
            // Verificar que el producto existe
            const producto = todosProductos.find(p => p.id === productId);
            if (!producto) {
                console.error(`Producto ID ${productId} no encontrado`);
                return;
            }
            
            // Cargar carrito existente
            const CARRITO_KEY = 'carrito_belleza_coreana';
            const carritoJSON = localStorage.getItem(CARRITO_KEY);
            let carrito = carritoJSON ? JSON.parse(carritoJSON) : [];
            
            // Validar que sea un array
            if (!Array.isArray(carrito)) {
                console.warn('Carrito no es array, inicializando nuevo');
                carrito = [];
            }
            
            // Buscar si el producto ya est√° en el carrito
            const index = carrito.findIndex(item => item && item.id === productId);
            
            if (index !== -1) {
                // Si ya existe, incrementar cantidad (m√°ximo 99)
                if (carrito[index].cantidad < 99) {
                    carrito[index].cantidad += 1;
                } else {
                    return;
                }
            } else {
                // Si no existe, agregar nuevo
                carrito.push({
                    id: productId,
                    cantidad: 1
                });
            }
            
            // Guardar en localStorage
            localStorage.setItem(CARRITO_KEY, JSON.stringify(carrito));
            
            // Actualizar contador visual
            actualizarContadorCarrito();
            
            // Animaci√≥n del bot√≥n si se proporcion√≥ (SOLO ANIMACI√ìN, SIN TEXTO "AGREGADO")
            if (buttonElement) {
                const originalBg = buttonElement.style.backgroundColor;
                const originalColor = buttonElement.style.color;
                
                buttonElement.style.backgroundColor = '#4CAF50';
                buttonElement.style.color = 'white';
                
                setTimeout(() => {
                    buttonElement.style.backgroundColor = originalBg || '#333';
                    buttonElement.style.color = originalColor || 'white';
                }, 300);
            }
            
            console.log(`üõí Carrito actualizado: ${carrito.length} tipos de productos`);
        }
        
        // Funci√≥n para actualizar contador del carrito
        function actualizarContadorCarrito() {
            const CARRITO_KEY = 'carrito_belleza_coreana';
            const carritoJSON = localStorage.getItem(CARRITO_KEY);
            let totalItems = 0;
            
            if (carritoJSON) {
                try {
                    const carrito = JSON.parse(carritoJSON);
                    if (Array.isArray(carrito)) {
                        totalItems = carrito.reduce((total, item) => {
                            if (item && item.cantidad) {
                                return total + item.cantidad;
                            }
                            return total;
                        }, 0);
                    }
                } catch (error) {
                    console.error('Error al contar carrito:', error);
                }
            }
            
            // Actualizar badge
            const badge = document.getElementById('cartBadge');
            if (badge) {
                badge.textContent = totalItems;
                badge.style.display = totalItems > 0 ? 'flex' : 'none';
            }
            
            return totalItems;
        }
        
        // Funci√≥n para buscar con Enter
        function setupBusqueda() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        buscarProductos();
                    }
                });
            }
        }
        
        // =================== INICIALIZACI√ìN ===================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Inicializando aplicaci√≥n...');
            cargarProductos();
            actualizarContadorCarrito();
            setupBusqueda();
            
            // Configurar navbar para dispositivos m√≥viles
            configurarNavbarResponsive();
            
            console.log('‚úÖ Aplicaci√≥n inicializada');
        });
        
        // Configurar navbar responsive
        function configurarNavbarResponsive() {
            const navItems = document.querySelectorAll('.nav-item');
            const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            
            if (isTouchDevice && window.innerWidth <= 768) {
                console.log('üì± Configurando navbar para dispositivos t√°ctiles');
                
                navItems.forEach(item => {
                    const link = item.querySelector('.nav-link');
                    
                    link.addEventListener('click', function(e) {
                        if (window.innerWidth <= 768) {
                            e.preventDefault();
                            const dropdown = item.querySelector('.dropdown-menu');
                            
                            // Cerrar otros dropdowns
                            document.querySelectorAll('.dropdown-menu').forEach(d => {
                                if (d !== dropdown) d.style.display = 'none';
                            });
                            
                            // Alternar este dropdown
                            if (dropdown.style.display === 'block') {
                                dropdown.style.display = 'none';
                            } else {
                                dropdown.style.display = 'block';
                            }
                        }
                    });
                });
                
                // Cerrar dropdowns al hacer clic fuera
                document.addEventListener('click', function(e) {
                    if (!e.target.closest('.nav-item')) {
                        document.querySelectorAll('.dropdown-menu').forEach(d => {
                            d.style.display = 'none';
                        });
                    }
                });
            }
        }
        
        // Hacer funciones disponibles globalmente
        window.abrirModalProducto = abrirModalProducto;
        window.cerrarModalProducto = cerrarModalProducto;
        window.abrirGaleriaProducto = abrirGaleriaProducto;
        window.cerrarGaleria = cerrarGaleria;
        window.cambiarImagenGaleria = cambiarImagenGaleria;
        window.seleccionarImagenGaleria = seleccionarImagenGaleria;
        window.abrirGaleriaDesdeModal = abrirGaleriaDesdeModal;
        window.agregarAlCarrito = agregarAlCarrito;
        window.agregarAlCarritoDesdeModal = agregarAlCarritoDesdeModal;
        window.buscarProductos = buscarProductos;
        window.manejarErrorImagen = manejarErrorImagen;
    </script>
</body>
</html>